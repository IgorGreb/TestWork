# Механіка гри

## Огляд
- Chick Game — вертикальна match-3 аркада, створена на Flutter + Riverpod.
- Кожна місія є окремим рівнем із власною ціллю за очками та описом (`lib/features/levels/level_missions.dart`).
- Гравець працює з дошкою 7x7, заповненою яйцями (`lib/features/game/egg_assets.dart`), і намагається набрати потрібний результат до завершення ходів і таймера.

## Ініціалізація дошки
- `GameController` (`lib/features/game/game_controller.dart`) генерує стартове поле, випадково підбираючи яйця для кожної клітинки й відхиляючи варіанти, що одразу утворюють ряд з трьох чи квадрат 2×2. Процес повторюється, поки на новій дошці не з’явиться хоча б один валідний хід.  
  Генерація виконується в окремому ізоляті, тому запуск рівня та перегенерації не блокують головний ізолят Flutter.
- Кожен тип яйця представляється цілим числом, що відповідає шляху в `eggAssetPaths`.

## Хід гри
1. Торкніться будь-якої клітинки, щоб виділити її (`selectedRow/selectedCol` у `GameState`).
2. Дотик по сусідній клітинці намагається обміняти їх місцями; якщо клітинка не сусідня — просто переносить виділення.
3. Обмін виконується на копії дошки. Хід вважається успішним лише тоді, коли з’являється горизонтальний/вертикальний ряд із ≥3 яєць або квадрат 2×2 одного типу. Невдалий обмін не витрачає хід і скидає виділення.
4. Успішний обмін зменшує `movesLeft` на 1 і запускає `_resolveBoard`.

## Виявлення матчів і каскади
- `_detectMatchGroups` сканує рядки й стовпці окремо, тому фігури на кшталт “T” або “+” враховуються як кілька груп. Далі перевіряються всі блоки 2×2.
- `_resolveBoard` повторюється, доки на дошці залишаються групи:
  - усі клітинки, що входять до груп, додаються в множину `removeSet`;
  - `score` збільшується на `group.length * 10`;
  - для груп довших за три додається монета й надсилається `HapticFeedback`;
  - клітинки позначаються значенням `-1`, стовпці обвалюються вниз, зверху додаються нові яйця, потім перевірка починається знову.
- Якщо після каскаду жодного можливого ходу не лишається, дошка генерується заново (рахунок і ходи не змінюються).
- Перемога: `score >= targetScore`.  
  Поразка: закінчилися ходи або час, а ціль не досягнута.

## Ходи, статуси та керування
- Кожна місія стартує з 25 ходами та власним обмеженням за часом (`timeLimitSeconds`). Таймер зупиняється під час паузи й скидається після рестарту.
- `GameStatus` визначає взаємодію:
  - `playing` — звичайна взаємодія.
  - `paused` — таймер і підказки зупиняються.
  - `won` / `lost` — поверх дошки показується сценографіка з написом, табличками SCORE/BEST і кнопками HOME/RESTART/ (та NEXT на перемогу).
- Після проходження рівня `levelsControllerProvider` відкриває наступну місію.

## Підказки
- У `GameScreen` працює `_hintTimer`, який раз на секунду перевіряє бездіяльність гравця. Якщо минуло 5 секунд без взаємодії, контролер знаходить перший валідний хід і записує його в `hintPositions`.
- `_BoardView` підсвічує такі клітинки жовтою рамкою. Після наступної дії підказка зникає.

## Монети та магазин
- `state.coinsEarned` відображає монети, здобуті за поточний рівень (комбінації з 4+ яєць). Різниця синхронізується з `ShopController`, який зберігає дані в `SharedPreferences`.
- `finalizeCoins()` додає бонус за перемогу: +5 монет і +2 за кожен невикористаний хід.
- `GameStatsRepository` так само в `SharedPreferences` тримає найкращий рекорд для кожного рівня і показує його на фінальному екрані.

## Прогрес та місії
- У `level_missions.dart` описано дев’ять місій із поступово вищими цілями й лімітами часу.
- `GameScreen` читає номер місії з аргументів навігації (за замовчуванням 1) і кешує її на час життя екрану.
- Коли стан переходить у `GameStatus.won`, місія позначається як завершена й стає доступною наступна.

## Підсумок UI
- Конструкція `ChickLayout` виводить HUD: результат, ціль, ходи, монети, опис місії, кнопку паузи та саму дошку.
- Клітинки рендеряться через `GridView.builder` із `AssetImage`. Виділені/підказки позначаються рамками.
- Під час перемоги або поразки поверх дошки показується затінений фон із керуючими кнопками, щоб уникнути випадкових дотиків.
